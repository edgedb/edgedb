name: Build Test and Publish Nightly Packages

on:
  schedule:
    - cron: "0 1 * * *"
  workflow_dispatch:
    inputs: {}
  push:
    branches:
      - nightly

jobs:
  prep:
    outputs:
      branch: ${{ steps.whichver.outputs.branch }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - id: whichver
      name: Determine package version
      run: 'branch=${GITHUB_REF#refs/heads/}

        echo branch="${branch}" >> $GITHUB_OUTPUT

        '
      shell: bash

  build-debian-buster-x86_64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: buster
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/debian-buster@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-debian-buster-x86_64
        path: artifacts/debian-buster

  build-debian-buster-aarch64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: buster
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/debian-buster@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-debian-buster-aarch64
        path: artifacts/debian-buster

  build-debian-bullseye-x86_64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: bullseye
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/debian-bullseye@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-debian-bullseye-x86_64
        path: artifacts/debian-bullseye

  build-debian-bullseye-aarch64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: bullseye
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/debian-bullseye@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-debian-bullseye-aarch64
        path: artifacts/debian-bullseye

  build-debian-bookworm-x86_64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: bookworm
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/debian-bookworm@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-debian-bookworm-x86_64
        path: artifacts/debian-bookworm

  build-debian-bookworm-aarch64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: bookworm
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/debian-bookworm@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-debian-bookworm-aarch64
        path: artifacts/debian-bookworm

  build-ubuntu-bionic-x86_64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: bionic
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/ubuntu-bionic@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-ubuntu-bionic-x86_64
        path: artifacts/ubuntu-bionic

  build-ubuntu-bionic-aarch64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: bionic
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/ubuntu-bionic@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-ubuntu-bionic-aarch64
        path: artifacts/ubuntu-bionic

  build-ubuntu-focal-x86_64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: focal
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/ubuntu-focal@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-ubuntu-focal-x86_64
        path: artifacts/ubuntu-focal

  build-ubuntu-focal-aarch64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: focal
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/ubuntu-focal@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-ubuntu-focal-aarch64
        path: artifacts/ubuntu-focal

  build-ubuntu-jammy-x86_64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: jammy
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/ubuntu-jammy@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-ubuntu-jammy-x86_64
        path: artifacts/ubuntu-jammy

  build-ubuntu-jammy-aarch64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: jammy
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/ubuntu-jammy@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-ubuntu-jammy-aarch64
        path: artifacts/ubuntu-jammy

  build-centos-7-x86_64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: centos
        PKG_PLATFORM_VERSION: '7'
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/centos-7@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-centos-7-x86_64
        path: artifacts/centos-7

  build-centos-8-x86_64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: centos
        PKG_PLATFORM_VERSION: '8'
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/centos-8@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-centos-8-x86_64
        path: artifacts/centos-8

  build-centos-8-aarch64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: centos
        PKG_PLATFORM_VERSION: '8'
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/centos-8@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-centos-8-aarch64
        path: artifacts/centos-8

  build-rockylinux-9-x86_64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: rockylinux
        PKG_PLATFORM_VERSION: '9'
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/rockylinux-9@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-rockylinux-9-x86_64
        path: artifacts/rockylinux-9

  build-rockylinux-9-aarch64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - env:
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: rockylinux
        PKG_PLATFORM_VERSION: '9'
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/rockylinux-9@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-rockylinux-9-aarch64
        path: artifacts/rockylinux-9

  build-linux-x86_64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - env:
        BUILD_GENERIC: true
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: linux
        PKG_PLATFORM_VERSION: x86_64
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/linux-x86_64@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-linux-x86_64
        path: artifacts/linux-x86_64

  build-linux-aarch64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - env:
        BUILD_GENERIC: true
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: linux
        PKG_PLATFORM_VERSION: aarch64
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/linux-aarch64@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-linux-aarch64
        path: artifacts/linux-aarch64

  build-linuxmusl-x86_64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - env:
        BUILD_GENERIC: true
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: linux
        PKG_PLATFORM_LIBC: musl
        PKG_PLATFORM_VERSION: x86_64
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/linuxmusl-x86_64@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-linuxmusl-x86_64
        path: artifacts/linuxmusl-x86_64

  build-linuxmusl-aarch64:
    needs: prep
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - env:
        BUILD_GENERIC: true
        EXTRA_OPTIMIZATIONS: 'true'
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: linux
        PKG_PLATFORM_LIBC: musl
        PKG_PLATFORM_VERSION: aarch64
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      uses: edgedb/edgedb-pkg/integration/linux/build/linuxmusl-aarch64@master
    - uses: actions/upload-artifact@v3
      with:
        name: builds-linuxmusl-aarch64
        path: artifacts/linuxmusl-aarch64

  build-macos-x86_64:
    needs: prep
    runs-on:
    - self-hosted
    - macOS
    - X64
    steps:
    - uses: actions/checkout@v3
      with:
        path: edgedb-pkg
        ref: master
        repository: edgedb/edgedb-pkg
    - if: false
      name: Install Rust toolchain
      uses: actions-rs/toolchain@v1
      with:
        default: true
        profile: minimal
        toolchain: stable
    - if: false
      name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.x
    - env:
        BUILD_GENERIC: true
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: macos
        PKG_PLATFORM_ARCH: x86_64
        PKG_PLATFORM_VERSION: x86_64
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      run: 'edgedb-pkg/integration/macos/build.sh

        '
    - uses: actions/upload-artifact@v3
      with:
        name: builds-macos-x86_64
        path: artifacts/macos-x86_64

  build-macos-aarch64:
    needs: prep
    runs-on:
    - self-hosted
    - macOS
    - ARM64
    steps:
    - uses: actions/checkout@v3
      with:
        path: edgedb-pkg
        ref: master
        repository: edgedb/edgedb-pkg
    - if: false
      name: Install Rust toolchain
      uses: actions-rs/toolchain@v1
      with:
        default: true
        profile: minimal
        toolchain: stable
    - if: false
      name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.x
    - env:
        BUILD_GENERIC: true
        METAPKG_GIT_CACHE: disabled
        PKG_PLATFORM: macos
        PKG_PLATFORM_ARCH: ''
        PKG_PLATFORM_VERSION: aarch64
        PKG_REVISION: <current-date>
        PKG_SUBDIST: nightly
        SRC_REF: ${{ needs.prep.outputs.branch }}
      name: Build
      run: 'edgedb-pkg/integration/macos/build.sh

        '
    - uses: actions/upload-artifact@v3
      with:
        name: builds-macos-aarch64
        path: artifacts/macos-aarch64

  test-debian-buster-x86_64:
    needs:
    - build-debian-buster-x86_64
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-buster-x86_64
        path: artifacts/debian-buster
    - env:
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: buster
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/debian-buster@master

  test-debian-buster-aarch64:
    needs:
    - build-debian-buster-aarch64
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-buster-aarch64
        path: artifacts/debian-buster
    - env:
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: buster
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/debian-buster@master

  test-debian-bullseye-x86_64:
    needs:
    - build-debian-bullseye-x86_64
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bullseye-x86_64
        path: artifacts/debian-bullseye
    - env:
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bullseye
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/debian-bullseye@master

  test-debian-bullseye-aarch64:
    needs:
    - build-debian-bullseye-aarch64
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bullseye-aarch64
        path: artifacts/debian-bullseye
    - env:
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bullseye
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/debian-bullseye@master

  test-debian-bookworm-x86_64:
    needs:
    - build-debian-bookworm-x86_64
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bookworm-x86_64
        path: artifacts/debian-bookworm
    - env:
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bookworm
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/debian-bookworm@master

  test-debian-bookworm-aarch64:
    needs:
    - build-debian-bookworm-aarch64
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bookworm-aarch64
        path: artifacts/debian-bookworm
    - env:
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bookworm
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/debian-bookworm@master

  test-ubuntu-bionic-x86_64:
    needs:
    - build-ubuntu-bionic-x86_64
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-bionic-x86_64
        path: artifacts/ubuntu-bionic
    - env:
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bionic
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/ubuntu-bionic@master

  test-ubuntu-bionic-aarch64:
    needs:
    - build-ubuntu-bionic-aarch64
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-bionic-aarch64
        path: artifacts/ubuntu-bionic
    - env:
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bionic
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/ubuntu-bionic@master

  test-ubuntu-focal-x86_64:
    needs:
    - build-ubuntu-focal-x86_64
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-focal-x86_64
        path: artifacts/ubuntu-focal
    - env:
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: focal
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/ubuntu-focal@master

  test-ubuntu-focal-aarch64:
    needs:
    - build-ubuntu-focal-aarch64
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-focal-aarch64
        path: artifacts/ubuntu-focal
    - env:
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: focal
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/ubuntu-focal@master

  test-ubuntu-jammy-x86_64:
    needs:
    - build-ubuntu-jammy-x86_64
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-jammy-x86_64
        path: artifacts/ubuntu-jammy
    - env:
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: jammy
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/ubuntu-jammy@master

  test-ubuntu-jammy-aarch64:
    needs:
    - build-ubuntu-jammy-aarch64
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-jammy-aarch64
        path: artifacts/ubuntu-jammy
    - env:
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: jammy
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/ubuntu-jammy@master

  test-centos-7-x86_64:
    needs:
    - build-centos-7-x86_64
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-centos-7-x86_64
        path: artifacts/centos-7
    - env:
        PKG_PLATFORM: centos
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: '7'
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/centos-7@master

  test-centos-8-x86_64:
    needs:
    - build-centos-8-x86_64
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-centos-8-x86_64
        path: artifacts/centos-8
    - env:
        PKG_PLATFORM: centos
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: '8'
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/centos-8@master

  test-centos-8-aarch64:
    needs:
    - build-centos-8-aarch64
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-centos-8-aarch64
        path: artifacts/centos-8
    - env:
        PKG_PLATFORM: centos
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: '8'
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/centos-8@master

  test-rockylinux-9-x86_64:
    needs:
    - build-rockylinux-9-x86_64
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-rockylinux-9-x86_64
        path: artifacts/rockylinux-9
    - env:
        PKG_PLATFORM: rockylinux
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: '9'
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/rockylinux-9@master

  test-rockylinux-9-aarch64:
    needs:
    - build-rockylinux-9-aarch64
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-rockylinux-9-aarch64
        path: artifacts/rockylinux-9
    - env:
        PKG_PLATFORM: rockylinux
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: '9'
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/rockylinux-9@master

  test-linux-x86_64:
    needs:
    - build-linux-x86_64
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linux-x86_64
        path: artifacts/linux-x86_64
    - env:
        PKG_PLATFORM: linux
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: x86_64
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/linux-x86_64@master

  test-linux-aarch64:
    needs:
    - build-linux-aarch64
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linux-aarch64
        path: artifacts/linux-aarch64
    - env:
        PKG_PLATFORM: linux
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: aarch64
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/linux-aarch64@master

  test-linuxmusl-x86_64:
    needs:
    - build-linuxmusl-x86_64
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linuxmusl-x86_64
        path: artifacts/linuxmusl-x86_64
    - env:
        PKG_PLATFORM: linux
        PKG_PLATFORM_LIBC: musl
        PKG_PLATFORM_VERSION: x86_64
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/linuxmusl-x86_64@master

  test-linuxmusl-aarch64:
    needs:
    - build-linuxmusl-aarch64
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linuxmusl-aarch64
        path: artifacts/linuxmusl-aarch64
    - env:
        PKG_PLATFORM: linux
        PKG_PLATFORM_LIBC: musl
        PKG_PLATFORM_VERSION: aarch64
        PKG_SUBDIST: nightly
        PKG_TEST_JOBS: 0
      name: Test
      uses: edgedb/edgedb-pkg/integration/linux/test/linuxmusl-aarch64@master

  test-macos-x86_64:
    needs:
    - build-macos-x86_64
    runs-on:
    - self-hosted
    - macOS
    - X64
    steps:
    - uses: actions/checkout@v3
      with:
        path: edgedb-pkg
        ref: master
        repository: edgedb/edgedb-pkg
    - uses: actions/download-artifact@v3
      with:
        name: builds-macos-x86_64
        path: artifacts/macos-x86_64
    - env:
        PKG_PLATFORM: macos
        PKG_PLATFORM_VERSION: x86_64
        PKG_SUBDIST: nightly
      name: Test
      run: 'edgedb-pkg/integration/macos/test.sh

        '

  test-macos-aarch64:
    needs:
    - build-macos-aarch64
    runs-on:
    - self-hosted
    - macOS
    - ARM64
    steps:
    - uses: actions/checkout@v3
      with:
        path: edgedb-pkg
        ref: master
        repository: edgedb/edgedb-pkg
    - uses: actions/download-artifact@v3
      with:
        name: builds-macos-aarch64
        path: artifacts/macos-aarch64
    - env:
        PKG_PLATFORM: macos
        PKG_PLATFORM_VERSION: aarch64
        PKG_SUBDIST: nightly
      name: Test
      run: 'edgedb-pkg/integration/macos/test.sh

        '

  publish-debian-buster-x86_64:
    needs:
    - test-debian-buster-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-buster-x86_64
        path: artifacts/debian-buster
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: buster
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-debian-buster-x86_64:
    needs:
    - publish-debian-buster-x86_64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-buster-x86_64
        path: artifacts/debian-buster
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: debian-buster
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: buster
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/debian-buster@master

  publish-beta-debian-buster:
    needs:
    - test-debian-buster-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-buster-x86_64
        path: artifacts/debian-buster
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: buster
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-debian-buster:
    needs:
    - publish-beta-debian-buster
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-buster-x86_64
        path: artifacts/debian-buster
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: debian-buster
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: buster
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/debian-buster@master

  publish-debian-buster-aarch64:
    needs:
    - test-debian-buster-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-buster-aarch64
        path: artifacts/debian-buster
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: buster
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-debian-buster-aarch64:
    needs:
    - publish-debian-buster-aarch64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-buster-aarch64
        path: artifacts/debian-buster
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: debian-buster
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: buster
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/debian-buster@master

  publish-beta-debian-buster:
    needs:
    - test-debian-buster-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-buster-aarch64
        path: artifacts/debian-buster
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: buster
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-debian-buster:
    needs:
    - publish-beta-debian-buster
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-buster-aarch64
        path: artifacts/debian-buster
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: debian-buster
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: buster
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/debian-buster@master

  publish-debian-bullseye-x86_64:
    needs:
    - test-debian-bullseye-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bullseye-x86_64
        path: artifacts/debian-bullseye
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bullseye
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-debian-bullseye-x86_64:
    needs:
    - publish-debian-bullseye-x86_64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bullseye-x86_64
        path: artifacts/debian-bullseye
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: debian-bullseye
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: bullseye
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/debian-bullseye@master

  publish-beta-debian-bullseye:
    needs:
    - test-debian-bullseye-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bullseye-x86_64
        path: artifacts/debian-bullseye
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bullseye
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-debian-bullseye:
    needs:
    - publish-beta-debian-bullseye
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bullseye-x86_64
        path: artifacts/debian-bullseye
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: debian-bullseye
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: bullseye
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/debian-bullseye@master

  publish-debian-bullseye-aarch64:
    needs:
    - test-debian-bullseye-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bullseye-aarch64
        path: artifacts/debian-bullseye
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bullseye
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-debian-bullseye-aarch64:
    needs:
    - publish-debian-bullseye-aarch64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bullseye-aarch64
        path: artifacts/debian-bullseye
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: debian-bullseye
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: bullseye
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/debian-bullseye@master

  publish-beta-debian-bullseye:
    needs:
    - test-debian-bullseye-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bullseye-aarch64
        path: artifacts/debian-bullseye
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bullseye
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-debian-bullseye:
    needs:
    - publish-beta-debian-bullseye
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bullseye-aarch64
        path: artifacts/debian-bullseye
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: debian-bullseye
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: bullseye
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/debian-bullseye@master

  publish-debian-bookworm-x86_64:
    needs:
    - test-debian-bookworm-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bookworm-x86_64
        path: artifacts/debian-bookworm
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bookworm
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-debian-bookworm-x86_64:
    needs:
    - publish-debian-bookworm-x86_64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bookworm-x86_64
        path: artifacts/debian-bookworm
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: debian-bookworm
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: bookworm
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/debian-bookworm@master

  publish-beta-debian-bookworm:
    needs:
    - test-debian-bookworm-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bookworm-x86_64
        path: artifacts/debian-bookworm
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bookworm
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-debian-bookworm:
    needs:
    - publish-beta-debian-bookworm
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bookworm-x86_64
        path: artifacts/debian-bookworm
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: debian-bookworm
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: bookworm
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/debian-bookworm@master

  publish-debian-bookworm-aarch64:
    needs:
    - test-debian-bookworm-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bookworm-aarch64
        path: artifacts/debian-bookworm
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bookworm
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-debian-bookworm-aarch64:
    needs:
    - publish-debian-bookworm-aarch64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bookworm-aarch64
        path: artifacts/debian-bookworm
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: debian-bookworm
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: bookworm
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/debian-bookworm@master

  publish-beta-debian-bookworm:
    needs:
    - test-debian-bookworm-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bookworm-aarch64
        path: artifacts/debian-bookworm
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bookworm
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-debian-bookworm:
    needs:
    - publish-beta-debian-bookworm
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-debian-bookworm-aarch64
        path: artifacts/debian-bookworm
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: debian-bookworm
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: debian
        PKG_PLATFORM_VERSION: bookworm
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/debian-bookworm@master

  publish-ubuntu-bionic-x86_64:
    needs:
    - test-ubuntu-bionic-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-bionic-x86_64
        path: artifacts/ubuntu-bionic
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bionic
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-ubuntu-bionic-x86_64:
    needs:
    - publish-ubuntu-bionic-x86_64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-bionic-x86_64
        path: artifacts/ubuntu-bionic
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: ubuntu-bionic
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: bionic
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/ubuntu-bionic@master

  publish-beta-ubuntu-bionic:
    needs:
    - test-ubuntu-bionic-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-bionic-x86_64
        path: artifacts/ubuntu-bionic
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bionic
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-ubuntu-bionic:
    needs:
    - publish-beta-ubuntu-bionic
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-bionic-x86_64
        path: artifacts/ubuntu-bionic
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: ubuntu-bionic
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: bionic
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/ubuntu-bionic@master

  publish-ubuntu-bionic-aarch64:
    needs:
    - test-ubuntu-bionic-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-bionic-aarch64
        path: artifacts/ubuntu-bionic
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bionic
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-ubuntu-bionic-aarch64:
    needs:
    - publish-ubuntu-bionic-aarch64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-bionic-aarch64
        path: artifacts/ubuntu-bionic
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: ubuntu-bionic
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: bionic
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/ubuntu-bionic@master

  publish-beta-ubuntu-bionic:
    needs:
    - test-ubuntu-bionic-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-bionic-aarch64
        path: artifacts/ubuntu-bionic
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: bionic
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-ubuntu-bionic:
    needs:
    - publish-beta-ubuntu-bionic
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-bionic-aarch64
        path: artifacts/ubuntu-bionic
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: ubuntu-bionic
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: bionic
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/ubuntu-bionic@master

  publish-ubuntu-focal-x86_64:
    needs:
    - test-ubuntu-focal-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-focal-x86_64
        path: artifacts/ubuntu-focal
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: focal
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-ubuntu-focal-x86_64:
    needs:
    - publish-ubuntu-focal-x86_64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-focal-x86_64
        path: artifacts/ubuntu-focal
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: ubuntu-focal
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: focal
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/ubuntu-focal@master

  publish-beta-ubuntu-focal:
    needs:
    - test-ubuntu-focal-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-focal-x86_64
        path: artifacts/ubuntu-focal
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: focal
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-ubuntu-focal:
    needs:
    - publish-beta-ubuntu-focal
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-focal-x86_64
        path: artifacts/ubuntu-focal
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: ubuntu-focal
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: focal
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/ubuntu-focal@master

  publish-ubuntu-focal-aarch64:
    needs:
    - test-ubuntu-focal-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-focal-aarch64
        path: artifacts/ubuntu-focal
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: focal
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-ubuntu-focal-aarch64:
    needs:
    - publish-ubuntu-focal-aarch64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-focal-aarch64
        path: artifacts/ubuntu-focal
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: ubuntu-focal
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: focal
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/ubuntu-focal@master

  publish-beta-ubuntu-focal:
    needs:
    - test-ubuntu-focal-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-focal-aarch64
        path: artifacts/ubuntu-focal
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: focal
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-ubuntu-focal:
    needs:
    - publish-beta-ubuntu-focal
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-focal-aarch64
        path: artifacts/ubuntu-focal
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: ubuntu-focal
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: focal
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/ubuntu-focal@master

  publish-ubuntu-jammy-x86_64:
    needs:
    - test-ubuntu-jammy-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-jammy-x86_64
        path: artifacts/ubuntu-jammy
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: jammy
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-ubuntu-jammy-x86_64:
    needs:
    - publish-ubuntu-jammy-x86_64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-jammy-x86_64
        path: artifacts/ubuntu-jammy
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: ubuntu-jammy
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: jammy
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/ubuntu-jammy@master

  publish-beta-ubuntu-jammy:
    needs:
    - test-ubuntu-jammy-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-jammy-x86_64
        path: artifacts/ubuntu-jammy
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: jammy
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-ubuntu-jammy:
    needs:
    - publish-beta-ubuntu-jammy
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-jammy-x86_64
        path: artifacts/ubuntu-jammy
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: ubuntu-jammy
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: jammy
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/ubuntu-jammy@master

  publish-ubuntu-jammy-aarch64:
    needs:
    - test-ubuntu-jammy-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-jammy-aarch64
        path: artifacts/ubuntu-jammy
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: jammy
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-ubuntu-jammy-aarch64:
    needs:
    - publish-ubuntu-jammy-aarch64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-jammy-aarch64
        path: artifacts/ubuntu-jammy
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: ubuntu-jammy
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: jammy
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/ubuntu-jammy@master

  publish-beta-ubuntu-jammy:
    needs:
    - test-ubuntu-jammy-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-jammy-aarch64
        path: artifacts/ubuntu-jammy
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: jammy
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-ubuntu-jammy:
    needs:
    - publish-beta-ubuntu-jammy
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-ubuntu-jammy-aarch64
        path: artifacts/ubuntu-jammy
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: ubuntu-jammy
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: ubuntu
        PKG_PLATFORM_VERSION: jammy
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/ubuntu-jammy@master

  publish-centos-7-x86_64:
    needs:
    - test-centos-7-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-centos-7-x86_64
        path: artifacts/centos-7
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: centos
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: '7'
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-centos-7-x86_64:
    needs:
    - publish-centos-7-x86_64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-centos-7-x86_64
        path: artifacts/centos-7
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: centos-7
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: centos
        PKG_PLATFORM_VERSION: '7'
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/centos-7@master

  publish-beta-centos-7:
    needs:
    - test-centos-7-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-centos-7-x86_64
        path: artifacts/centos-7
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: centos
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: '7'
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-centos-7:
    needs:
    - publish-beta-centos-7
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-centos-7-x86_64
        path: artifacts/centos-7
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: centos-7
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: centos
        PKG_PLATFORM_VERSION: '7'
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/centos-7@master

  publish-centos-8-x86_64:
    needs:
    - test-centos-8-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-centos-8-x86_64
        path: artifacts/centos-8
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: centos
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: '8'
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-centos-8-x86_64:
    needs:
    - publish-centos-8-x86_64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-centos-8-x86_64
        path: artifacts/centos-8
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: centos-8
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: centos
        PKG_PLATFORM_VERSION: '8'
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/centos-8@master

  publish-beta-centos-8:
    needs:
    - test-centos-8-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-centos-8-x86_64
        path: artifacts/centos-8
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: centos
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: '8'
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-centos-8:
    needs:
    - publish-beta-centos-8
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-centos-8-x86_64
        path: artifacts/centos-8
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: centos-8
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: centos
        PKG_PLATFORM_VERSION: '8'
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/centos-8@master

  publish-centos-8-aarch64:
    needs:
    - test-centos-8-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-centos-8-aarch64
        path: artifacts/centos-8
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: centos
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: '8'
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-centos-8-aarch64:
    needs:
    - publish-centos-8-aarch64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-centos-8-aarch64
        path: artifacts/centos-8
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: centos-8
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: centos
        PKG_PLATFORM_VERSION: '8'
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/centos-8@master

  publish-beta-centos-8:
    needs:
    - test-centos-8-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-centos-8-aarch64
        path: artifacts/centos-8
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: centos
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: '8'
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-centos-8:
    needs:
    - publish-beta-centos-8
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-centos-8-aarch64
        path: artifacts/centos-8
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: centos-8
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: centos
        PKG_PLATFORM_VERSION: '8'
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/centos-8@master

  publish-rockylinux-9-x86_64:
    needs:
    - test-rockylinux-9-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-rockylinux-9-x86_64
        path: artifacts/rockylinux-9
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: rockylinux
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: '9'
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-rockylinux-9-x86_64:
    needs:
    - publish-rockylinux-9-x86_64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-rockylinux-9-x86_64
        path: artifacts/rockylinux-9
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: rockylinux-9
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: rockylinux
        PKG_PLATFORM_VERSION: '9'
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/rockylinux-9@master

  publish-beta-rockylinux-9:
    needs:
    - test-rockylinux-9-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-rockylinux-9-x86_64
        path: artifacts/rockylinux-9
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: rockylinux
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: '9'
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-rockylinux-9:
    needs:
    - publish-beta-rockylinux-9
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-rockylinux-9-x86_64
        path: artifacts/rockylinux-9
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: rockylinux-9
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: rockylinux
        PKG_PLATFORM_VERSION: '9'
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/rockylinux-9@master

  publish-rockylinux-9-aarch64:
    needs:
    - test-rockylinux-9-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-rockylinux-9-aarch64
        path: artifacts/rockylinux-9
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: rockylinux
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: '9'
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-rockylinux-9-aarch64:
    needs:
    - publish-rockylinux-9-aarch64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-rockylinux-9-aarch64
        path: artifacts/rockylinux-9
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: rockylinux-9
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: rockylinux
        PKG_PLATFORM_VERSION: '9'
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/rockylinux-9@master

  publish-beta-rockylinux-9:
    needs:
    - test-rockylinux-9-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-rockylinux-9-aarch64
        path: artifacts/rockylinux-9
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: rockylinux
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: '9'
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-rockylinux-9:
    needs:
    - publish-beta-rockylinux-9
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-rockylinux-9-aarch64
        path: artifacts/rockylinux-9
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: rockylinux-9
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: rockylinux
        PKG_PLATFORM_VERSION: '9'
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/rockylinux-9@master

  publish-linux-x86_64:
    needs:
    - test-linux-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linux-x86_64
        path: artifacts/linux-x86_64
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: linux
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: x86_64
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-linux-x86_64:
    needs:
    - publish-linux-x86_64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linux-x86_64
        path: artifacts/linux-x86_64
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: linux-x86_64
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: linux
        PKG_PLATFORM_VERSION: x86_64
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/linux-x86_64@master

  publish-beta-linux:
    needs:
    - test-linux-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linux-x86_64
        path: artifacts/linux-x86_64
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: linux
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: x86_64
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-linux:
    needs:
    - publish-beta-linux
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linux-x86_64
        path: artifacts/linux-x86_64
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: linux-x86_64
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: linux
        PKG_PLATFORM_VERSION: x86_64
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/linux-x86_64@master

  publish-linux-aarch64:
    needs:
    - test-linux-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linux-aarch64
        path: artifacts/linux-aarch64
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: linux
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: aarch64
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-linux-aarch64:
    needs:
    - publish-linux-aarch64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linux-aarch64
        path: artifacts/linux-aarch64
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: linux-aarch64
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: linux
        PKG_PLATFORM_VERSION: aarch64
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/linux-aarch64@master

  publish-beta-linux:
    needs:
    - test-linux-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linux-aarch64
        path: artifacts/linux-aarch64
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: linux
        PKG_PLATFORM_LIBC: ''
        PKG_PLATFORM_VERSION: aarch64
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-linux:
    needs:
    - publish-beta-linux
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linux-aarch64
        path: artifacts/linux-aarch64
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: linux-aarch64
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: linux
        PKG_PLATFORM_VERSION: aarch64
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/linux-aarch64@master

  publish-linuxmusl-x86_64:
    needs:
    - test-linuxmusl-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linuxmusl-x86_64
        path: artifacts/linuxmusl-x86_64
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: linux
        PKG_PLATFORM_LIBC: musl
        PKG_PLATFORM_VERSION: x86_64
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-linuxmusl-x86_64:
    needs:
    - publish-linuxmusl-x86_64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linuxmusl-x86_64
        path: artifacts/linuxmusl-x86_64
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: linuxmusl-x86_64
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: linux
        PKG_PLATFORM_VERSION: x86_64
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/linuxmusl-x86_64@master

  publish-beta-linuxmusl:
    needs:
    - test-linuxmusl-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linuxmusl-x86_64
        path: artifacts/linuxmusl-x86_64
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: linux
        PKG_PLATFORM_LIBC: musl
        PKG_PLATFORM_VERSION: x86_64
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-linuxmusl:
    needs:
    - publish-beta-linuxmusl
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - x64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linuxmusl-x86_64
        path: artifacts/linuxmusl-x86_64
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: linuxmusl-x86_64
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: linux
        PKG_PLATFORM_VERSION: x86_64
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/linuxmusl-x86_64@master

  publish-linuxmusl-aarch64:
    needs:
    - test-linuxmusl-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linuxmusl-aarch64
        path: artifacts/linuxmusl-aarch64
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: linux
        PKG_PLATFORM_LIBC: musl
        PKG_PLATFORM_VERSION: aarch64
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-linuxmusl-aarch64:
    needs:
    - publish-linuxmusl-aarch64
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linuxmusl-aarch64
        path: artifacts/linuxmusl-aarch64
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: linuxmusl-aarch64
    - env:
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: linux
        PKG_PLATFORM_VERSION: aarch64
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/linuxmusl-aarch64@master

  publish-beta-linuxmusl:
    needs:
    - test-linuxmusl-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linuxmusl-aarch64
        path: artifacts/linuxmusl-aarch64
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: linux
        PKG_PLATFORM_LIBC: musl
        PKG_PLATFORM_VERSION: aarch64
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  check-published-beta-linuxmusl:
    needs:
    - publish-beta-linuxmusl
    outputs:
      catalog-version: ${{ steps.describe.outputs.catalog-version }}
      version-core: ${{ steps.describe.outputs.version-core }}
      version-slot: ${{ steps.describe.outputs.version-slot }}
    runs-on:
    - self-hosted
    - linux
    - arm64
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-linuxmusl-aarch64
        path: artifacts/linuxmusl-aarch64
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: linuxmusl-aarch64
    - env:
        PACKAGE_SERVER: package-upload.edgedb.net
        PKG_INSTALL_REF: ${{ steps.describe.outputs.install-ref }}
        PKG_NAME: ${{ steps.describe.outputs.name }}
        PKG_PLATFORM: linux
        PKG_PLATFORM_VERSION: aarch64
        PKG_SUBDIST: nightly
        PKG_VERSION_SLOT: ${{ steps.describe.outputs.version-slot }}
      name: Test Published
      uses: edgedb/edgedb-pkg/integration/linux/testpublished/linuxmusl-aarch64@master

  publish-macos-x86_64:
    needs:
    - test-macos-x86_64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-macos-x86_64
        path: artifacts/macos-x86_64
    - uses: actions/checkout@v3
      with:
        path: edgedb-pkg
        ref: master
        repository: edgedb/edgedb-pkg
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: macos-x86_64
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: macos
        PKG_PLATFORM_VERSION: x86_64
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  publish-macos-aarch64:
    needs:
    - test-macos-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v3
      with:
        name: builds-macos-aarch64
        path: artifacts/macos-aarch64
    - uses: actions/checkout@v3
      with:
        path: edgedb-pkg
        ref: master
        repository: edgedb/edgedb-pkg
    - id: describe
      name: Describe
      uses: edgedb/edgedb-pkg/integration/actions/describe-artifact@master
      with:
        target: macos-aarch64
    - env:
        PACKAGE_UPLOAD_SSH_KEY: ${{ secrets.PACKAGE_UPLOAD_SSH_KEY }}
        PKG_PLATFORM: macos
        PKG_PLATFORM_VERSION: aarch64
        PKG_SUBDIST: nightly
      name: Publish
      uses: edgedb/edgedb-pkg/integration/linux/upload/linux-x86_64@master

  publish-docker:
    needs:
    - check-published-debian-buster-x86_64
    - check-published-debian-buster-aarch64
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        path: dockerfile
        ref: master
        repository: edgedb/edgedb-docker
    - env:
        PKG_SUBDIST: nightly
        VERSION_CORE: ${{ needs.check-published-debian-buster-x86_64.outputs.version-core
          }}
        VERSION_SLOT: ${{ needs.check-published-debian-buster-x86_64.outputs.version-slot
          }}
      id: tags
      run: "set -e\n\nurl='https://registry.hub.docker.com/v2/repositories/edgedb/edgedb/tags?page_size=100'\n\
        repo_tags=$(\n  while [ -n \"$url\" ]; do\n    resp=$(curl -L -s \"$url\")\n\
        \    url=$(echo \"$resp\" | jq -r \".next\")\n    if [ \"$url\" = \"null\" ]\
        \ || [ -z \"$url\" ]; then\n      break\n    fi\n    echo \"$resp\" | jq -r\
        \ '.\"results\"[][\"name\"]'\n  done | grep \"^[[:digit:]]\\+.*\" | grep -v\
        \ \"alpha\\|beta\\|rc\" || :\n)\n\ntags=( \"$VERSION_CORE\" )\n\ntop=$(printf\
        \ \"%s\\n%s\\n\" \"$VERSION_CORE\" \"$repo_tags\" \\\n      | grep \"^${VERSION_SLOT}[\\\
        .-]\" \\\n      | sort --version-sort --reverse | head -n 1)\nif [ \"$top\"\
        \ == \"$VERSION_CORE\" ]; then\n  tags+=( \"$VERSION_SLOT\" )\nfi\n\nif [ -z\
        \ \"$PKG_SUBDIST\" ]; then\n  top=$(printf \"%s\\n%s\\n\" \"$VERSION_CORE\"\
        \ \"$repo_tags\" \\\n        | sort --version-sort --reverse | head -n 1)\n\
        \  if [ \"$top\" == \"$VERSION_CORE\" ]; then\n    tags+=( \"latest\" )\n  fi\n\
        fi\n\nIFS=,\necho \"tags=${tags[*]}\" >> $GITHUB_OUTPUT\n"
    - name: Set up QEMU
      uses: docker/setup-qemu-action@v2
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v2
    - name: Publish Docker Image (docker.io)
      uses: elgohr/Publish-Docker-Github-Action@43dc228e327224b2eda11c8883232afd5b34943b
      with:
        buildargs: version=${{ needs.check-published-debian-buster-x86_64.outputs.version-slot
          }},exact_version=${{ needs.check-published-debian-buster-x86_64.outputs.version-core
          }},subdist=nightly
        name: edgedb/edgedb
        password: ${{ secrets.DOCKER_PASSWORD }}
        platforms: linux/amd64,linux/arm64
        tags: nightly,nightly_${{ needs.check-published-debian-buster-x86_64.outputs.version-slot
          }}_cv${{ needs.check-published-debian-buster-x86_64.outputs.catalog-version
          }}
        username: ${{ secrets.DOCKER_USERNAME }}
        workdir: dockerfile
    - name: Publish Docker Image (ghcr.io)
      uses: elgohr/Publish-Docker-Github-Action@43dc228e327224b2eda11c8883232afd5b34943b
      with:
        buildargs: version=${{ needs.check-published-debian-buster-x86_64.outputs.version-slot
          }},exact_version=${{ needs.check-published-debian-buster-x86_64.outputs.version-core
          }},subdist=nightly
        name: ${{ github.repository }}
        password: ${{ secrets.GITHUB_CI_BOT_TOKEN }}
        platforms: linux/amd64,linux/arm64
        registry: ghcr.io
        tags: nightly,nightly_${{ needs.check-published-debian-buster-x86_64.outputs.version-slot
          }}_cv${{ needs.check-published-debian-buster-x86_64.outputs.catalog-version
          }}
        username: edgedb-ci
        workdir: dockerfile

