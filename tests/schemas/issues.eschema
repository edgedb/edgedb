abstract type Text:
    # This is an abstract object containing text.
    required link body to str:
        # Maximum length of text is 10000 characters.
        constraint maxlength(10000)


abstract type Named:
    required link name to str


# Dictionary is a NamedObject variant, that enforces
# name uniqueness across all instances if its subclass.
abstract type Dictionary extending Named:
    required link name to str:
        delegated constraint unique


link todo:
    link property rank to int:
        default := 42


type User extending Dictionary:
    link todo to Issue:
        mapping := '**'


abstract type Owned:
    # By default links are optional.
    required link owner to User:
        mapping := '*1'


type Status extending Dictionary


type Priority extending Dictionary


type LogEntry extending Owned, Text:
    # LogEntry is an Owned and a Text, so it
    # will have all of their links and attributes,
    # in particular, owner and text links.
    required link spent_time to int


# issue_num_t is defined as a concrete sequence type,
# used to generate sequential issue numbers.
scalar type issue_num_t extending std::sequence


type Comment extending Text, Owned:
    required link issue to Issue:
        mapping := '*1'
    link parent to Comment:
        mapping := '*1'


type Issue extending Named, Owned, Text:
    required link number to issue_num_t:
        readonly := true
        # The number values are automatically generated,
        # and are not supposed to be directly writable.
        constraint unique

    required link status to Status:
        mapping := '*1'

    link priority to Priority:
        mapping := '*1'

    link watchers to User:
        mapping := '**'
        # The watchers link is mapped to User type in
        # many-to-many relation.  The default mapping is
        # *1 -- many-to-one.

    link time_estimate to int

    link time_spent_log to LogEntry:
        mapping := '1*'
        # 1* -- one-to-many mapping.

    link start_date to datetime:
        default := SELECT current_datetime()
        # The default value of start_date will be a
        # result of the EdgeQL expression above.

    link due_date to datetime

    link related_to to Issue:
        mapping := '**'

    # this is used to test virtual types
    link references to File, URL, Publication:
        mapping := '**'

    link tags to array<str>


type File extending Named


type URL extending Named:
    required link address to str


type Publication:
    required link title to str
