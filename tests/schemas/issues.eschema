abstract concept Text:
    # This is an abstract object containing text.
    required link body to str:
        # Maximum length of text is 10000 characters.
        constraint maxlength(10000)


abstract concept Named:
    required link name to str


# Dictionary is a NamedObject variant, that enforces
# name uniqueness across all instances if its subclass.
abstract concept Dictionary extends Named:
    required link name to str:
        abstract constraint unique


link todo:
    linkproperty rank to int:
        default: 42


concept User extends Named:
    link todo to Issue:
        mapping: **


abstract concept Owned:
    # By default links are optional.
    required link owner to User:
        mapping: *1


concept Status extends Dictionary


concept Priority extends Dictionary


concept LogEntry extends Owned, Text:
    # LogEntry is an Owned and a Text, so it
    # will have all of their links and attributes,
    # in particular, owner and text links.
    required link spent_time to int


# issue_num_t is defined as a concrete sequence type,
# used to generate sequential issue numbers.
atom issue_num_t extends std::sequence


concept Comment extends Text, Owned:
    required link issue to Issue:
        mapping: *1
    link parent to Comment:
        mapping: *1


concept Issue extends Named, Owned, Text:
    required link number to issue_num_t:
        readonly: true
        # The number values are automatically generated,
        # and are not supposed to be directly writable.

    required link status to Status:
        mapping: *1

    link priority to Priority:
        mapping: *1

    link watchers to User:
        mapping: **
        # The watchers link is mapped to User concept in
        # many-to-many relation.  The default mapping is
        # *1 -- many-to-one.

    link time_estimate to int

    link time_spent_log to LogEntry:
        mapping: 1*
        # 1* -- one-to-many mapping.

    link start_date to datetime:
        default := SELECT current_datetime()
        # The default value of start_date will be a
        # result of the EdgeQL expression above.

    link due_date to datetime

    link related_to to Issue:
        mapping: **

    # this is used to test virtual concepts
    link references to File, URL, Publication:
        mapping: **

    link tags to array<str>


concept File extends Named


concept URL extends Named:
    required link address to str


concept Publication:
    required link title to str
