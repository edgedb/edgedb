INSERT User {
    login := 'alice',
    firstname := 'Alice',
    lastname := 'Liddell',
};

INSERT User {
    login := 'bob',
    firstname := 'Bob',
    lastname := 'Sponge',
};

INSERT User {
    login := 'carol',
    firstname := 'Carol',
    lastname := 'Danvers',
};

INSERT User {
    login := 'dave',
    firstname := 'Dave',
    lastname := 'Bowman',
};


WITH
    A := (SELECT User FILTER .login = 'alice'),
    B := (SELECT User FILTER .login = 'bob')
INSERT PullRequest {
    title := 'Avoid attaching multiple scopes at once',
    status := 'Merged',
    author := A,
    assignees := B,
    body := "Sublime Text and Atom handles multiple scopes differently.",
    created_on := <datetime>'Feb 1, 2016, 5:29PM',
    comments := {
        (INSERT Comment {
            author := A,
            body :=
                "Sublime Text handles whitespace-separated scope list " +
                "pretty well, but Atom (or the 'first-mate' library to be " +
                "precise) would fail to do that.",
            created_on := <datetime>'Feb 1, 2016, 5:31 PM',
        }),
        (INSERT Comment {
            author := B,
            body :=
                "Thanks for catching that. We'll make sure to follow this " +
                "practice.",
            created_on := <datetime>'Feb 2, 2016, 12:47 PM',
        }),
        (INSERT Comment {
            author := A,
            body := "You're welcome. Thanks for the awesome package!",
            created_on := <datetime>'Feb 2, 2016, 12:48 PM',
        }),
    }
};


WITH
    B := (SELECT User FILTER .login = 'bob'),
    C := (SELECT User FILTER .login = 'carol'),
    D := (SELECT User FILTER .login = 'dave')
INSERT PullRequest {
    title := 'Pyhton -> Python',
    status := 'Merged',
    author := C,
    assignees := {B, D},
    body := "Several typos fixed.",
    created_on := <datetime>'Apr 25, 2016, 6:57 PM',
    comments := {
        (INSERT Comment {
            author := C,
            body := "Couple of typos are fixed. Updated VS count.",
            created_on := <datetime>'Apr 25, 2016, 6:58 PM',
        }),
        (INSERT Comment {
            author := B,
            body := "Thanks for catching the typo.",
            created_on := <datetime>'Apr 25, 2016, 7:11 PM',
        }),
        (INSERT Comment {
            author := D,
            body := "Thanks!",
            created_on := <datetime>'Apr 25, 2016, 7:22 PM',
        }),
    }
};


WITH
    B := (SELECT User FILTER .login = 'bob'),
    C := (SELECT User FILTER .login = 'carol')
INSERT PullRequest {
    title := 'Highlight type hint stub files',
    status := 'Merged',
    author := B,
    assignees := C,
    body := "",
    created_on := <datetime>'Jun 28, 2016, 7:31 PM',
    comments := {
        (INSERT Comment {
            author := B,
            body := "Highlight type hint stub files.",
            created_on := <datetime>'Jun 28, 2016, 7:32 PM',
        }),
        (INSERT Comment {
            author := C,
            body := "Good idea! Thanks.",
            created_on := <datetime>'Jun 28, 2016, 8:01 PM',
        }),
        (INSERT Comment {
            author := C,
            body := "I've released v0.5.12 with this patch.",
            created_on := <datetime>'Jun 28, 2016, 8:03 PM',
        }),
    }
};


WITH
    B := (SELECT User FILTER .login = 'bob')
INSERT PullRequest {
    title := 'Tokenize `@` in decorators',
    status := 'Open',
    author := B,
    assignees := B,
    body := "Fixes an issue with `@`",
    created_on := <datetime>'Nov 13, 2017, 12:39 PM',
    comments := {
        (INSERT Comment {
            author := B,
            body := "@ now has its own scope",
            created_on := <datetime>'Nov 13, 2017, 12:40 PM',
        }),
        (INSERT Comment {
            author := B,
            body := "I have the same build failure on master",
            created_on := <datetime>'Nov 13, 2017, 1:04 PM',
        }),
        (INSERT Comment {
            author := B,
            body := "Should I submit a PR to fix the CI build?",
            created_on := <datetime>'Nov 15, 2017, 12:50 PM',
        }),
    }
};


WITH
    C := (SELECT User FILTER .login = 'carol')
INSERT PullRequest {
    title := 'Add support for Snakemake files',
    status := 'Open',
    author := C,
    assignees := C,
    body := "",
    created_on := <datetime>'Jan 24, 2018, 6:19 PM',
    comments := {
        (INSERT Comment {
            author := C,
            body :=
                "This PR adds support for Python syntax highlighting in " +
                ".smk files, which are used by Snakemake.",
            created_on := <datetime>'Jan 24, 2018, 6:20 PM',
        }),
    }
};


UPDATE
    User
FILTER
    User.login = 'dave'
SET {
    todo := (
        SELECT PullRequest {
            @weight :=
                1 IF PullRequest.title = 'Tokenize `@` in decorators' ELSE 2
        } FILTER PullRequest.title IN {
            'Tokenize `@` in decorators',
            'Add support for Snakemake files',
        }
    )
};


WITH
    U2 := User
UPDATE
    User
FILTER
    User.login = 'carol'
SET {
    followees := (
        SELECT U2 FILTER U2.login = {'alice', 'bob'}
    )
};


WITH
    U2 := User
UPDATE
    User
FILTER
    User.login = 'alice'
SET {
    followees := (
        SELECT U2 FILTER U2 != User
    )
};
