##
# Copyright (c) 2008-2016 MagicStack Inc.
# All rights reserved.
#
# See LICENSE for details.
##


scalar type constraint_length extending str:
    constraint maxlength(16)
    constraint maxlength(10)
    constraint minlength(5)
    constraint minlength(8)


scalar type constraint_length_2 extending constraint_length:
    constraint minlength(9)


scalar type constraint_minmax extending str:
    constraint min("99900000")
    constraint min("99990000")
    constraint max("9999999989")


scalar type constraint_strvalue extending str:
    constraint expression on (__subject__[-1:] = '9')

    constraint regexp("^\d+$")

    constraint expression on (__subject__[0] = '9')

    constraint regexp("^\d+9{3,}.*$")


scalar type constraint_enum extending str:
   constraint enum(['foo', 'bar'])


link translated_label:
    mapping := '1*'

    link property lang to str
    link property prop1 to str


link link_with_unique_property:
    link property unique_property to str:
        constraint unique

    link property unique_property2 to str:
        constraint unique


link link_with_unique_property_inherited extending link_with_unique_property


link another_link_with_unique_property:
    link property unique_property to str


link another_link_with_unique_property_inherited extending another_link_with_unique_property


type Object:
    link name to str:
        constraint unique
        constraint unique on (std::lower(__subject__))

    link c_length to constraint_length
    link c_length_2 to constraint_length_2
    link c_length_3 to constraint_length_2:
        constraint minlength(10)

    link c_minmax to constraint_minmax
    link c_strvalue to constraint_strvalue
    link c_enum to constraint_enum

    link translated_label to str:
        constraint unique on (__subject__@source, __subject__@lang)
        constraint unique on (__subject__@prop1)


type UniqueName:
    link name to str:
        constraint unique

    link name2 to str:
        constraint unique

    link link_with_unique_property to str

    link link_with_unique_property_inherited to str

    link translated_label to str:
        constraint unique on (__subject__@source, __subject__@lang)
        constraint unique on (__subject__@prop1)


type UniqueNameInherited extending UniqueName:
    link name to str


type UniqueNameGrandchild extending UniqueNameInherited


type UniqueDescription:
    link description to str

    link another_link_with_unique_property to str

    link another_link_with_unique_property_inherited to str


type UniqueDescriptionInherited extending UniqueDescription


type UniqueName_2_Renamed:
    link name to str:
        constraint unique


type UniqueName_2_Inherited extending UniqueName_2_Renamed


type UniqueName_3 extending UniqueName_2_Renamed


type UniqueName_4 extending UniqueName_2_Inherited


type MultiConstraint_Renamed:
    link name to str:
        constraint unique
        constraint unique on (lower(__subject__))

    link m1 to str


type ParentUniqueName:
    link name to str:
        constraint unique


type ReceivingParent extending ParentUniqueName:
    link name to str


type LosingParent:
    link name to str
    link lp to str


type AbstractConstraintParent:
    link name to str:
        delegated constraint unique


type AbstractConstraintParent2:
    link name to str:
        delegated constraint unique on (lower(__subject__))


type AbstractConstraintPureChild extending AbstractConstraintParent


type AbstractConstraintMixedChild extending AbstractConstraintParent:
    link name to str:
        constraint unique on (lower(__subject__))


type AbstractConstraintPropagated extending AbstractConstraintParent:
    link name to str:
        delegated constraint unique


type AbstractConstraintParent3:
    link name to str:
        delegated constraint unique
        delegated constraint unique on (lower(__subject__))


type AbstractConstraintMultipleParentsFlattening extending AbstractConstraintParent, AbstractConstraintParent2:
    link flat to str


type LosingAbstractConstraintParent:
    link name to str:
        constraint unique


type LosingAbstractConstraintParent2:
    link name to str


type BecomingAbstractConstraint:
    link name to str:
        delegated constraint unique


type BecomingAbstractConstraintChild extending BecomingAbstractConstraint


type BecomingConcreteConstraint:
    link name to str:
        constraint unique


type BecomingConcreteConstraintChild extending BecomingConcreteConstraint


type AbstractInheritingNonAbstract:
    link name to str:
        delegated constraint unique


type AbstractInheritingNonAbstractChild extending AbstractInheritingNonAbstract
