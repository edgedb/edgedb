##
# Copyright (c) 2008-2016 MagicStack Inc.
# All rights reserved.
#
# See LICENSE for details.
##


atom constraint_length extending str:
    constraint maxlength(16)
    constraint maxlength(10)
    constraint minlength(5)
    constraint minlength(8)


atom constraint_length_2 extending constraint_length:
    constraint minlength(9)


atom constraint_minmax extending str:
    constraint min("99900000")
    constraint min("99990000")
    constraint max("9999999989")


atom constraint_strvalue extending str:
    constraint expression on ((subject)[-1:] = '9')

    constraint regexp("^\d+$")

    constraint expression on ((subject)[0] = '9')

    constraint regexp("^\d+9{3,}.*$")


atom constraint_enum extending str:
   constraint enum(['foo', 'bar'])


link translated_label:
    mapping := '1*'

    linkproperty lang to str
    linkproperty prop1 to str


link link_with_unique_property:
    linkproperty unique_property to str:
        constraint unique


link link_with_unique_property_inherited extending link_with_unique_property


link another_link_with_unique_property:
    linkproperty unique_property to str:
        constraint unique


link another_link_with_unique_property_inherited extending another_link_with_unique_property


concept Object:
    link name to str
    link c_length to constraint_length
    link c_length_2 to constraint_length_2
    link c_length_3 to constraint_length_2:
        constraint minlength(10)

    link c_minmax to constraint_minmax
    link c_strvalue to constraint_strvalue
    link c_enum to constraint_enum


concept UniqueName:
    link name to str:
        constraint unique

    link link_with_unique_property to str

    link link_with_unique_property_inherited to str

    link translated_label to str:
        constraint unique on (subject@source, subject@lang)
        constraint unique on (subject@prop1)


concept UniqueNameInherited extending UniqueName:
    link name to str


concept UniqueDescription:
    link description to str:
        constraint unique

    link another_link_with_unique_property to str

    link another_link_with_unique_property_inherited to str


concept UniqueDescriptionInherited extending UniqueDescription


concept UniqueName_2:
    link name to str:
        constraint unique


concept UniqueName_2_Inherited extending UniqueName_2


concept UniqueName_3 extending UniqueName_2:
    link name to str:
        constraint unique on (lower(subject))


concept UniqueName_4 extending UniqueName_2_Inherited


concept MultiConstraint:
    link name to str:
        constraint unique
        constraint unique on (lower(subject))

    link m1 to str


concept ParentUniqueName:
    link name to str:
        constraint unique


concept ReceivingParent:
    link name to str


concept LosingParent extending ParentUniqueName:
    link name to str
    link lp to str


concept AbstractConstraintParent:
    link name to str:
        delegated constraint unique


concept AbstractConstraintParent2:
    link name to str:
        delegated constraint unique on (lower(subject))


concept AbstractConstraintPureChild extending AbstractConstraintParent


concept AbstractConstraintMixedChild extending AbstractConstraintParent:
    link name to str:
        constraint unique on (lower(subject))


concept AbstractConstraintPropagated extending AbstractConstraintParent:
    link name to str:
        delegated constraint unique


concept AbstractConstraintParent3:
    link name to str:
        delegated constraint unique
        delegated constraint unique on (lower(subject))


concept AbstractConstraintMultipleParentsFlattening extending AbstractConstraintParent, AbstractConstraintParent2:
    link flat to str


concept LosingAbstractConstraintParent extending AbstractConstraintParent


concept LosingAbstractConstraintParent2 extending AbstractConstraintParent


concept BecomingAbstractConstraint:
    link name to str:
        constraint unique


concept BecomingAbstractConstraintChild extending BecomingAbstractConstraint


concept BecomingConcreteConstraint:
    link name to str:
        delegated constraint unique


concept BecomingConcreteConstraintChild extending BecomingConcreteConstraint


concept AbstractInheritingNonAbstract extending ParentUniqueName:
    link name to str:
        delegated constraint unique


concept AbstractInheritingNonAbstractChild extending AbstractInheritingNonAbstract
